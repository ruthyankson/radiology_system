{% extends "admin/base.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<script type="text/javascript" src="{% static 'assets/js/bootstrap.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<!-- custom style -->
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/admin_styles.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/accordion.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'ckeditor/ckeditor.css' %}" />
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Dashboard</a> &rsaquo;
    <a href="{% url 'admin:patients_patient_changelist' %}">Patients</a> &rsaquo;
    Patient Detail
</div>
{% endblock %}


{% block content %}
{{ block.super }}

<div class="container detail_main">
    <div class="row">
        <div class="col-md-12 mb-4">
            <button type="button" class="btn btn-primary tab_buttons" id="spec_ope">
                <i class="fas fa-toolbox mr-2"></i>
                Operations
            </button>
            <button type="button" class="btn btn-primary tab_buttons" id="pat_main">
                <i class="fas fa-eye mr-2"></i>
                Main
            </button>
            <button type="button" class="btn btn-primary tab_buttons" id="pat_doc">
                <i class="fas fa-file mr-2"></i>
                Docs
            </button>
        </div>
    </div>
    <div id="pat_main_details" style="display: none;">
        <div class="identity_tag">
            {{ patient.name }}'s details
        </div>
        <div class="row mb-5">
            <div class="col-md-6 align-self-start detail_side_left">
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.hospital_number }}:</div>
                    <div class="col">{{ patient.hospital_number }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.patient_type }}:</div>
                    <div class="col">{{ patient.patient_type }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.name }}:</div>
                    <div class="col">{{ patient.name }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.date_of_birth }}:</div>
                    <div class="col">{{ patient.date_of_birth | date:'M d, Y' }} </div>
                </div>
            </div>
            <div class="col-md-6 align-self-start detail_side_right">

                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.age }}:</div>
                    <div class="col">{{ patient.age }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.gender }}:</div>
                    <div class="col">{{ patient.gender }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.contact }}:</div>
                    <div class="col">{{ patient.contact }} </div>
                </div>
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.address }}:</div>
                    <div class="col">{{ patient.address }} </div>
                </div>
                {% if patient.gender == 'F' %}
                <div class="row single_detail">
                    <div class="col detail_label">{{ labels.pregnant }}:</div>
                    <div class="col">{{ patient.pregnant }} </div>
                </div>
                {% endif %}

            </div>
        </div>
        <div class="row sec_section">
            <div class="col-md-12">
                <div class="h5">General Notes</div>
                <table class="table" width="100%">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Title</th>
                            <th>Date</th>
                            <th>Detail</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if general_note_labels != "No data" %}
                        {% for item in patient_notes %}
                        <tr class="general_note_item patient_item" data-item-id="{{ item.id }}">
                            <td>{{ forloop.counter }}</td>
                            <td>{{ item.note_title }}</td>
                            <td>{{ item.note_date }}</td>
                            <td><i class="fas fa-eye"></i></td>
                        </tr>
                        <tr>

                            <td colspan="4">
                                <div class="container">
                                    <div class="row note_item_details" id="item-{{ item.id }}" style="display: none;">
                                        <div class="col-md-12">
                                            <div class="row mb-3">
                                                <div class="col-md-6 detail_label">{{ general_note_labels.note_title }}:
                                                </div>
                                                <div class="col-md-6">{{ item.note_title }}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6 detail_label">{{ general_note_labels.note }}:</div>
                                                <div class="col-md-6">{{ item.note }}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6 detail_label">{{ general_note_labels.note_date }}:
                                                </div>
                                                <div class="col-md-6">{{ item.note_date }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td class="no_data">No data</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="docs_details" style="display: none;">
        <div class="identity_tag">
            <div class="h5">{{ patient.name }}'s Documents</div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="accordion" id="accordionPanelsStayOpen">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseOne">
                                Approvals
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                            aria-labelledby="panelsStayOpen-headingOne">
                            <div class="accordion-body">
                                Some approvals
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingFive">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseFive">
                                Radiologist / Radiographer Notes
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse"
                            aria-labelledby="panelsStayOpen-headingFive">
                            <div class="accordion-body">
                                <table class="table table-striped table-hover" width="100%">
                                    <thead>
                                        <tr>
                                            <th>#</td>
                                            <th>Process</td>
                                            <th>Personnel Involved</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>Imgaging</td>
                                            <td>Mr. Akutse</td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseThree">
                                Diagnoses
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse"
                            aria-labelledby="panelsStayOpen-headingThree">
                            <div class="accordion-body">
                                <table class="table table-striped table-hover" width="100%">
                                    <thead>
                                        <tr>
                                            <th>#</td>
                                            <th>Process</td>
                                            <th>Personnel Involved</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>Imgaging</td>
                                            <td>Mr. Akutse</td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingFour">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseFour">
                                Imaging Requests
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse"
                            aria-labelledby="panelsStayOpen-headingFour">
                            <div class="accordion-body">
                                <table class="table table-striped table-hover" width="100%">
                                    <thead>
                                        <tr>
                                            <th>#</td>
                                            <th>Process</td>
                                            <th>Personnel Involved</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>Imgaging</td>
                                            <td>Mr. Akutse</td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseTwo">
                                Imaging Records
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse"
                            aria-labelledby="panelsStayOpen-headingTwo">
                            <div class="accordion-body">
                            </div>
                            <div class="add_doc">📝</div>
                            <table class="table table-striped table-hover" width="100%">
                                <thead>
                                    <tr>
                                        <th>#</td>
                                        <th>Process</td>
                                        <th>Personnel Involved</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Imgaging</td>
                                        <td>Mr. Akutse</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="panelsStayOpen-headingSix">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#panelsStayOpen-collapseSix" aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseSix">
                                Rejected Images and Reasons
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapseSix" class="accordion-collapse collapse"
                            aria-labelledby="panelsStayOpen-headingSix">
                            <div class="accordion-body">
                            </div>
                            <div class="add_doc">📝</div>
                            <table class="table table-striped table-hover" width="100%">
                                <thead>
                                    <tr>
                                        <th>#</td>
                                        <th>Process</td>
                                        <th>Personnel Involved</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Imgaging</td>
                                        <td>Mr. Akutse</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="pat_operations">
        <div class="identity_tag">
            <div class="h5">Specific Operations</div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="title_add">
                                <button type="button" class="btn btn-outline-success ope_buttons" id="add_general_note">
                                    <i class="fas fa-plus mr-2" id="fa_gen_add"></i><i class="fas fa-minus mr-2"
                                        id="fa_gen_minus" style="display: none;"></i>
                                    General Note
                                </button>
                                <button type="button" class="btn btn-outline-info ope_buttons" id="add_rad_note">
                                    <i class="fas fa-plus mr-2" id="fa_rad_add"></i><i class="fas fa-minus mr-2"
                                        id="fa_rad_minus" style="display: none;"></i>
                                    Rad Note
                                </button>
                                <button type="button" class="btn btn-outline-primary ope_buttons" id="add_diagnosis">
                                    <i class="fas fa-plus mr-2" id="fa_diag_add"></i><i class="fas fa-minus mr-2"
                                        id="fa_diag_minus" style="display: none;"></i>
                                    Diagnosis
                                </button>
                                <button type="button" class="btn btn-outline-secondary ope_buttons" id="add_request">
                                    <i class="fas fa-plus mr-2" id="fa_req_add"></i><i class="fas fa-minus mr-2"
                                        id="fa_req_minus" style="display: none;"></i>
                                    Request
                                </button>
                                <button type="button" class="btn btn-outline-warning ope_buttons" id="add_imaging">
                                    <i class="fas fa-plus mr-2" id="fa_imaging_add"></i><i class="fas fa-minus mr-2"
                                        id="fa_imaging_minus" style="display: none;"></i>
                                    Imaging
                                </button>
                                <button type="button" class="btn btn-outline-dark ope_buttons"
                                    id="add_post_preparation">
                                    <i class="fas fa-plus mr-2" id="fa_post_preparation_add"></i><i
                                        class="fas fa-minus mr-2" id="fa_post_preparation_minus" style="display: none;"></i>
                                    Post Preparation
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="space"></div>
                    <div class="detail_summary">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-6 single_detail">
                                        <div class="row">
                                            <div class="col-md-3 detail_label">{{ labels.name }}:</div>
                                            <div class="col-md-9">{{ patient.name }} </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 single_detail">
                                        <div class="row">
                                            <div class="col-md-5 detail_label">{{ labels.date_of_birth }}:</div>
                                            <div class="col-md-7 summary_val">
                                                {{ patient.date_of_birth | date:'M d, Y' }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-6 single_detail">
                                        <div class="row">
                                            <div class="col-md-3 detail_label">{{ labels.age }}:</div>
                                            <div class="col-md-9 summary_val">{{ patient.age }} </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 single_detail">
                                        <div class="row">
                                            <div class="col-md-5 detail_label">{{ labels.gender }}:</div>
                                            <div class="col-md-7">{{ patient.gender }} </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="showHere">
                        <div class="col-md-12">
                            <div id="general_note_form" style="display: none;">
                                <div class="h5 mb-3">
                                    General Notes
                                </div>
                                <form method="post" id="id_general_note_form">
                                    {% csrf_token %}
                                    {{ form_general_note.as_p }}
                                    <button class="btn btn-info" type="submit">Save</button>
                                </form>
                            </div>
                            <div id="rad_note_form" style="display: none;">
                                <div class="h5 mb-3">
                                    Radiologist/Radiographer Notes
                                </div>
                                <form method="post" id="id_rad_note_form">
                                    {% csrf_token %}
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.weight.label }}
                                            </label>
                                            {{ form_rad_note.weight }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.type_of_procedure.label }}
                                            </label>
                                            {{ form_rad_note.type_of_procedure }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.pre_procedure_bp_systolic.label }}
                                            </label>
                                            {{ form_rad_note.pre_procedure_bp_systolic }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.pre_procedure_bp_diastolic.label }}
                                            </label>
                                            {{ form_rad_note.pre_procedure_bp_diastolic }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.pre_pulse.label }}
                                            </label>
                                            {{ form_rad_note.pre_pulse }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.post_pulse.label }}
                                            </label>
                                            {{ form_rad_note.post_pulse }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.start_time_of_exams.label }}
                                            </label>
                                            {{ form_rad_note.start_time_of_exams }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.end_time_of_exams.label }}
                                            </label>
                                            {{ form_rad_note.end_time_of_exams }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.volume_of_contrast.label }}
                                            </label>
                                            {{ form_rad_note.volume_of_contrast }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.flow_rate.label }}
                                            </label>
                                            {{ form_rad_note.flow_rate }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.post_procedure_bp_systolic.label }}
                                            </label>
                                            {{ form_rad_note.post_procedure_bp_systolic }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_rad_note.post_procedure_bp_diastolic.label }}
                                            </label>
                                            {{ form_rad_note.post_procedure_bp_diastolic }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_rad_note.general_comments.label }}
                                            </label>
                                            {{ form_rad_note.general_comments }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_rad_note.note_date.label }}
                                            </label>
                                            {{ form_rad_note.note_date }}
                                        </div>
                                    </div>

                                    <div class="mt-3"><button class="btn btn-info" type="submit">Save</button></div>
                                </form>
                            </div>
                            <div id="diag_form" style="display: none;">
                                <div class="h5 mb-3">
                                    Diagnoses
                                </div>
                                <form method="post" id="id_form_diagnosis">
                                    {% csrf_token %}
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_diagnosis.study_date.label }}
                                            </label>
                                            {{ form_diagnosis.study_date }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_diagnosis.ward.label }}
                                            </label>
                                            {{ form_diagnosis.ward }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_diagnosis.requesting_physician.label }}
                                            </label>
                                            {{ form_diagnosis.requesting_physician }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_diagnosis.examination.label }}
                                            </label>
                                            {{ form_diagnosis.examination }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_diagnosis.technique.label }}
                                            </label>
                                            <p>{{ form_diagnosis.technique }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_diagnosis.findings.label }}
                                            </label>
                                            <p>{{ form_diagnosis.findings }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_diagnosis.impressions.label }}
                                            </label>
                                            <p>{{ form_diagnosis.impressions }}</p>
                                        </div>
                                    </div>
                                    <button class="btn btn-info" type="submit">Save</button>
                                </form>
                            </div>

                            <div id="req_form" style="display: none;">
                                <div class="h5  mb-3">
                                    Imaging Request
                                </div>
                                <form method="post" id="id_form_image_request">
                                    {% csrf_token %}
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_image_request.request_date.label }}
                                            </label>
                                            {{ form_image_request.request_date }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_image_request.ward.label }}
                                            </label>
                                            {{ form_image_request.ward }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_image_request.brief_clinical_history.label }}
                                            </label>
                                            <p>{{ form_image_request.brief_clinical_history }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_image_request.radiological_investigation_requested.label }}
                                            </label>
                                            <p>{{ form_image_request.radiological_investigation_requested }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_image_request.medical_officer.label }}
                                            </label>
                                            <p>{{ form_image_request.medical_officer }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_image_request.department.label }}
                                            </label>
                                            {{ form_image_request.department }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_image_request.radiology_serial_number.label }}
                                            </label>
                                            {{ form_image_request.radiology_serial_number }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-12">
                                            <label>
                                                {{ form_image_request.previous_exams_details.label }}
                                            </label>
                                            <p>{{ form_image_request.previous_exams_details }}</p>
                                        </div>
                                    </div>
                                    <button class="btn btn-info" type="submit">Save</button>
                                </form>
                            </div>
                            <div id="imaging_form" style="display: none;">
                                <div class="h5 mb-3">
                                    Imaging Record
                                </div>
                                <form method="post" id="imaging_record_form">
                                    {% csrf_token %}
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.record_date.label }}
                                            </label>
                                            {{ form_imaging_record.record_date }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.radiology_staff_id.label }}
                                            </label>
                                            {{ form_imaging_record.radiology_staff_id }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.examination_room.label }}
                                            </label>
                                            {{ form_imaging_record.examination_room }}
                                            {% if form_imaging_record.examination_room.errors %}
                                                <div class="errors">{{ form_imaging_record.examination_room.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.examination_repeat_type.label }}
                                            </label>
                                            {{ form_imaging_record.examination_repeat_type }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.examination_type.label }}
                                            </label>
                                            {{ form_imaging_record.examination_type }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_status.image_status.label }}
                                            </label>
                                            {{ form_imaging_status.image_status }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.setup_type.label }}
                                            </label>
                                            {{ form_imaging_record.setup_type }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.ctdi.label }}
                                            </label>
                                            <p>{{ form_imaging_record.ctdi }}</p>
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.radiation_quality.label }}
                                            </label>
                                            {{ form_imaging_record.radiation_quality }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.radiation_quantity.label }}
                                            </label>
                                            {{ form_imaging_record.radiation_quantity }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.current.label }}
                                            </label>
                                            {{ form_imaging_record.current }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.radiation_time.label }}
                                            </label>
                                            {{ form_imaging_record.radiation_time }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.dose_area_product.label }}
                                            </label>
                                            {{ form_imaging_record.dose_area_product }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_imaging_record.dose_length_product.label }}
                                            </label>
                                            {{ form_imaging_record.dose_length_product }}
                                        </div>
                                    </div>                                                                      
                                    <div class="row mb-4" id="reject_reasons_form" style="display: none;">
                                        <div class="col-md-12">
                                            <div class="h6">
                                                Reject Reasons
                                            </div>
                                                {{ form_reject_reasons.as_p }}
                                        </div>
                                    </div>
                                    <div id="hidden_submit" style="display: none;">
                                        <button class="btn btn-info" type="submit">Save</button>
                                    </div>
                                </form>
                            </div>
                            <div id="post_preparation_form" style="display: none;">
                                <div class="h5 mb-3">
                                    Post Preparation Note
                                </div>
                                <form method="post" id="id_form_post_preparation">
                                    {% csrf_token %}
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_post_preparation.preparation_confirmation.label }}
                                            </label>
                                            {{ form_post_preparation.preparation_confirmation }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_post_preparation.injection_swelling.label }}
                                            </label>
                                            {{ form_post_preparation.injection_swelling }}
                                        </div>
                                    </div>
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_post_preparation.staff_signature.label }}
                                            </label>
                                            {{ form_post_preparation.staff_signature }}
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                {{ form_post_preparation.preparation_date.label }}
                                            </label>
                                            {{ form_post_preparation.preparation_date }}
                                        </div>
                                    </div>
                                    <button class="btn btn-info" type="submit">Save</button>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Your custom content here -->
{% endblock %}

{% block extrajs %}

{{ block.super }}
<!-- Modal -->
<div class="modal fade" id="rejectReasonsModal" tabindex="-1" aria-hidden="true"
 aria-labelledby="rejectReasonsModalLabel">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rejectReasonsModalLabel">Reject Reasons</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="detailsBody">
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close_modal" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>



<!-- The Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="closem">&times;</span>
        <p>Modal Content Goes Here</p>
    </div>
</div>


<script>

    document.addEventListener("DOMContentLoaded", function () {

        const btn_gen_note = document.getElementById("add_general_note");
        const btn_rad_note = document.getElementById("add_rad_note");
        const btn_diagnosis = document.getElementById("add_diagnosis");
        const btn_request = document.getElementById("add_request");
        const btn_imaging = document.getElementById("add_imaging");
        const btn_post_preparation = document.getElementById("add_post_preparation")

        const gen_note_form = document.getElementById("general_note_form");
        const rad_note_form = document.getElementById("rad_note_form");
        const diag_form = document.getElementById("diag_form");
        const req_form = document.getElementById("req_form");
        const imaging_form = document.getElementById("imaging_form");
        const post_preparation_form = document.getElementById("post_preparation_form")

        const fa_gen_add = document.getElementById("fa_gen_add");
        const fa_gen_minus = document.getElementById("fa_gen_minus");
        const fa_rad_minus = document.getElementById("fa_rad_minus");
        const fa_rad_add = document.getElementById("fa_rad_add");
        const fa_diag_minus = document.getElementById("fa_diag_minus");
        const fa_diag_add = document.getElementById("fa_diag_add");
        const fa_req_add = document.getElementById("fa_req_add");
        const fa_req_minus = document.getElementById("fa_req_minus");
        const fa_imaging_add = document.getElementById("fa_imaging_add");
        const fa_imaging_minus = document.getElementById("fa_imaging_minus");
        const fa_post_preparation_add = document.getElementById("fa_post_preparation_add")
        const fa_post_preparation_minus = document.getElementById("fa_post_preparation_minus")

        btn_gen_note.onclick = showGenNoteForm;
        btn_rad_note.onclick = showRadNoteForm;
        btn_diagnosis.onclick = showDiagForm;
        btn_request.onclick = showReqForm;
        btn_imaging.onclick = showImagingForm;
        btn_post_preparation.onclick = showPostPreparationForm;

        function showGenNoteForm(event) {
            if (gen_note_form.style.display !== "none") {
                gen_note_form.style.display = "none";
                fa_gen_add.style.display = "inline";
                fa_gen_minus.style.display = "none";
            } else {
                gen_note_form.style.display = "block";
                fa_gen_minus.style.display = "inline";
                fa_gen_add.style.display = "none";

                rad_note_form.style.display = "none";
                diag_form.style.display = "none";
                req_form.style.display = "none";
                imaging_form.style.display = "none";
                post_preparation_form.style.display = "none";

                fa_rad_minus.style.display = "none";
                fa_diag_minus.style.display = "none";
                fa_req_minus.style.display = "none";
                fa_imaging_minus.style.display = "none";
                fa_post_preparation_minus.style.display = "none";

                fa_rad_add.style.display = "inline";
                fa_diag_add.style.display = "inline";
                fa_req_add.style.display = "inline";
                fa_imaging_add.style.display = "inline";
                fa_post_preparation_add.style.display = "inline";
            }
        }

        function showRadNoteForm() {
            if (rad_note_form.style.display !== "none") {
                rad_note_form.style.display = "none";
                fa_rad_add.style.display = "inline";
                fa_rad_minus.style.display = "none";
            } else {
                rad_note_form.style.display = "block";
                fa_rad_minus.style.display = "inline";
                fa_rad_add.style.display = "none";

                diag_form.style.display = "none";
                req_form.style.display = "none";
                imaging_form.style.display = "none";
                gen_note_form.style.display = "none";
                post_preparation_form.style.display = "none";

                fa_gen_minus.style.display = "none";
                fa_diag_minus.style.display = "none";
                fa_req_minus.style.display = "none";
                fa_imaging_minus.style.display = "none";
                fa_post_preparation_minus.style.display = "none";

                fa_gen_add.style.display = "inline";
                fa_diag_add.style.display = "inline";
                fa_req_add.style.display = "inline";
                fa_imaging_add.style.display = "inline";
                fa_post_preparation_add.style.display = "inline";
            }
        }

        function showDiagForm() {
            if (diag_form.style.display !== "none") {
                diag_form.style.display = "none";
                fa_diag_add.style.display = "inline";
                fa_diag_minus.style.display = "none";
            } else {
                diag_form.style.display = "block";
                fa_diag_minus.style.display = "inline";
                fa_diag_add.style.display = "none";

                rad_note_form.style.display = "none";
                req_form.style.display = "none";
                imaging_form.style.display = "none";
                gen_note_form.style.display = "none";
                post_preparation_form.style.display = "none";

                fa_gen_minus.style.display = "none";
                fa_rad_minus.style.display = "none";
                fa_req_minus.style.display = "none";
                fa_imaging_minus.style.display = "none";
                fa_post_preparation_minus.style.display = "none";

                fa_gen_add.style.display = "inline";
                fa_rad_add.style.display = "inline";
                fa_req_add.style.display = "inline";
                fa_imaging_add.style.display = "inline";
                fa_post_preparation_add.style.display = "inline";
            }
        }

        function showReqForm() {
            if (req_form.style.display !== "none") {
                req_form.style.display = "none";
                fa_req_add.style.display = "inline";
                fa_req_minus.style.display = "none";
            } else {
                req_form.style.display = "block";
                fa_req_minus.style.display = "inline";
                fa_req_add.style.display = "none";

                rad_note_form.style.display = "none";
                diag_form.style.display = "none";
                imaging_form.style.display = "none";
                gen_note_form.style.display = "none";
                post_preparation_form.style.display = "none";

                fa_gen_minus.style.display = "none";
                fa_rad_minus.style.display = "none";
                fa_diag_minus.style.display = "none";
                fa_imaging_minus.style.display = "none";
                fa_post_preparation_minus.style.display = "none";

                fa_gen_add.style.display = "inline";
                fa_rad_add.style.display = "inline";
                fa_diag_add.style.display = "inline";
                fa_imaging_add.style.display = "inline";
                fa_post_preparation_add.style.display = "inline";
            }
        }

        function showImagingForm() {
            if (imaging_form.style.display !== "none") {
                imaging_form.style.display = "none";
                fa_imaging_add.style.display = "inline";
                fa_imaging_minus.style.display = "none";
            } else {
                imaging_form.style.display = "block";
                fa_imaging_minus.style.display = "inline";
                fa_imaging_add.style.display = "none";

                rad_note_form.style.display = "none";
                diag_form.style.display = "none";
                req_form.style.display = "none";
                gen_note_form.style.display = "none";
                post_preparation_form.style.display = "none";

                fa_gen_minus.style.display = "none";
                fa_rad_minus.style.display = "none";
                fa_diag_minus.style.display = "none";
                fa_req_minus.style.display = "none";
                fa_post_preparation_minus.style.display = "none";

                fa_gen_add.style.display = "inline";
                fa_rad_add.style.display = "inline";
                fa_diag_add.style.display = "inline";
                fa_req_add.style.display = "inline";
                fa_post_preparation_add.style.display = "inline";
            }
        }

        function showPostPreparationForm() {
            if (post_preparation_form.style.display !== "none") {
                post_preparation_form.style.display = "none";
                fa_post_preparation_add.style.display = "inline";
                fa_post_preparation_minus.style.display = "none";
            } else {
                post_preparation_form.style.display = "block";
                fa_post_preparation_minus.style.display = "inline";
                fa_post_preparation_add.style.display = "none";

                rad_note_form.style.display = "none";
                diag_form.style.display = "none";
                req_form.style.display = "none";
                gen_note_form.style.display = "none";
                imaging_form.style.display = "none";

                fa_gen_minus.style.display = "none";
                fa_rad_minus.style.display = "none";
                fa_diag_minus.style.display = "none";
                fa_req_minus.style.display = "none";
                fa_imaging_minus.style.display = "none";

                fa_gen_add.style.display = "inline";
                fa_rad_add.style.display = "inline";
                fa_diag_add.style.display = "inline";
                fa_req_add.style.display = "inline";
                fa_imaging_add.style.display = "inline";
            }
        }

        let generalNoteItems = document.querySelectorAll('.general_note_item');
        const noteDivs = document.querySelectorAll(".note_item_details");

        generalNoteItems.forEach(generalNoteItem => {
            generalNoteItem.addEventListener('click', function () {
                const itemId = generalNoteItem.getAttribute('data-item-id');
                noteDivs.forEach(div => div.style.display = 'none');

                noteDivs.forEach(div => div.style.display = 'none');  // hide all noteDivs

                const targetDiv = document.getElementById('item-' + itemId);
                if (targetDiv) {
                    targetDiv.style.display = 'block';  // display the corresponding div
                }
            });
        });

        const btn_main_detail = document.getElementById("pat_main");
        const btn_docs = document.getElementById("pat_doc");
        const btn_operations = document.getElementById("spec_ope");

        const section_main_detail = document.getElementById("pat_main_details");
        const section_docs = document.getElementById("docs_details");
        const section_operations = document.getElementById("pat_operations");

        btn_main_detail.onclick = showMainDetail;
        btn_docs.onclick = showDocs;
        btn_operations.onclick = showOperations;

        function showMainDetail(event) {
            if (section_main_detail.style.display !== "none") {
                section_main_detail.style.display = "none";
            } else {
                section_main_detail.style.display = "block";
                section_docs.style.display = "none";
                section_operations.style.display = "none";
            }
        }

        function showDocs(event) {
            if (section_docs.style.display !== "none") {
                section_docs.style.display = "none";
            } else {
                section_docs.style.display = "block";
                section_main_detail.style.display = "none";
                section_operations.style.display = "none";
            }
        }

        function showOperations(event) {
            if (section_operations.style.display !== "none") {
                section_operations.style.display = "none";
            } else {
                section_operations.style.display = "block";
                section_main_detail.style.display = "none";
                section_docs.style.display = "none";
            }
        }

        // const form = document.getElementById('myForm');
        // const modal = document.getElementById('rejectReasonsModal');
        const modal = $('#rejectReasonsModal');
        // const closeModalButton = document.querySelector('.closem');
        // let image_status = "{{ record_status }}";
        modal.modal({ 
            show: false,          
            backdrop: 'static',
            keyboard: false  // to also prevent closing with keyboard
        });
        // imaging_form.addEventListener('submit', function (event) {
        //     // After form submission logic (or AJAX success), show the modal:
        //     // event.preventDefault();
        //     // modal.modal('show');
        //     if (image_status == "Rejected") {
        //         event.preventDefault();
        //         modal.modal('show');
        //     } else {
        //         modal.modal('hide');
        //     }
        // });       

        $('.close').click(function () {
            modal.modal('hide');
        });
        $('.close_modal').click(function () {
            modal.modal('hide');
        });
        // closeModalButton.addEventListener('click', function () {
        //     modal.style.display = 'none';
        // });

        let hiddenSubmit = document.getElementById("hidden_submit");
        let factorsSelect = document.getElementById("id_factors");
        let subFactorsSelect = document.getElementById("id_sub_factors");
        const statusRejected = document.getElementById('id_image_status_1');
        const statusAccepted = document.getElementById('id_image_status_0');
        let factorsSelected = false;
        let subFactorsSelected = false;
        let imagingRecordForm = document.getElementById("imaging_record_form");
        let rejectReasonsForm = document.getElementById("reject_reasons_form");

        if (imagingRecordForm) {
            const statusRejected = document.getElementById('id_image_status_1');
            let imageStatus = document.querySelector("#id_image_status");
            // let pregnantField = document.querySelector(".field-pregnant");

            // pregnantField.style.display = (statusRejected.checked) ? "block" : "none";

            imageStatus.addEventListener("change", function () {
                if (statusRejected.checked) {
                    rejectReasonsForm.style.display = "block";
                    hiddenSubmit.style.display = "none";
                } else {
                    rejectReasonsForm.style.display = "none";
                    hiddenSubmit.style.display = "block";
                }
            });

            let selectedSubFactors = [];
            let selectedFactors = [];

            factorsSelect.addEventListener('change', function () {
                var selectedOptions = this.selectedOptions;

                if (selectedOptions.length === 0) {
                    factorsSelected = false;
                } else {
                    factorsSelected = true;
                }

                subFactorsSelect.addEventListener('change', function () {
                    selectedSubFactors = this.selectedOptions;

                    if (selectedSubFactors.length === 0) {
                        subFactorsSelected = false;
                    } else {
                        subFactorsSelected = true;
                    }

                    if (statusRejected.checked && factorsSelected === true && subFactorsSelected === true) {
                        hiddenSubmit.style.display = "block";
                    } else {
                        hiddenSubmit.style.display = "none";
                    }
                });
            });
        }
    });

</script>


{% endblock %}